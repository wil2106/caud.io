cache:
  paths:
    - node_modules/

stages:
  - init
  - test
  - deploy_prod

init:
  stage: init
  image: node:12.18.3
  script:
    - npm install

test:
  stage: test
  image: node:12.18.3
  script:
    - npm test

deploy_prod:
  stage: deploy_prod
  image: node:12.18.3
  script:
    - git push https://$HEROKU_USER:$HEROKU_API_KEY@git.heroku.com/caudio.git HEAD:master
    - echo "Deployed to prod server"
  environment:
    name: production
    url: https://caudio.herokuapp.com
  only:
    - master